<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFXIV ‰ªô‰∫∫ÂæÆÂΩ©Ë®àÁÆóÂô® - ÈÄ≤ÈöéÁâà</title>
    <meta name="description" content="Final Fantasy XIV ‰ªô‰∫∫ÂæÆÂΩ©Ë®àÁÆóÂô®ÈÄ≤ÈöéÁâàÔºåÊèê‰æõÊè≠Ê†ºÂª∫Ë≠∞„ÄÅÊ¶ÇÁéáÂàÜÊûê„ÄÅÈ¢®Èö™Ë©ï‰º∞ÔºåÂπ´Âä©‰Ω†ÂÅöÂá∫ÊúÄ‰Ω≥Ê±∫Á≠ñ„ÄÇ">

    <!-- Open Graph -->
    <meta property="og:title" content="FFXIV ‰ªô‰∫∫ÂæÆÂΩ©Ë®àÁÆóÂô® - ÈÄ≤ÈöéÁâà">
    <meta property="og:description" content="Êèê‰æõÊè≠Ê†ºÂª∫Ë≠∞„ÄÅÊ¶ÇÁéáÂàÜÊûê„ÄÅÈ¢®Èö™Ë©ï‰º∞ÁöÑÈÄ≤Èöé‰ªô‰∫∫ÂæÆÂΩ©Ë®àÁÆóÂô®">
    <meta property="og:type" content="website">

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #0d1117;
            --panel-bg: #161b22;
            --panel-bg-light: #21262d;
            --text-color: #e6edf3;
            --text-muted: #8b949e;
            --gold: #f0b429;
            --gold-dim: #9e7a1a;
            --gold-highlight: #ffd666;
            --input-bg: #0d1117;
            --border-color: #30363d;
            --error-color: #f85149;
            --success-color: #3fb950;
            --info-color: #58a6ff;
            --purple: #a371f7;
            --cyan: #39d353;
            --orange: #f78166;
            --gradient-gold: linear-gradient(135deg, #f0b429 0%, #d4a012 100%);
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color);
            background-image: 
                radial-gradient(ellipse at top, rgba(240, 180, 41, 0.03) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(163, 113, 247, 0.03) 0%, transparent 50%);
            color: var(--text-color);
            margin: 0;
            padding: 15px;
            min-height: 100vh;
        }

        #app {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            color: var(--gold);
            margin: 0;
            font-size: clamp(1.3rem, 3.5vw, 1.8rem);
            text-align: center;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(240, 180, 41, 0.3);
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 13px;
            margin-top: 4px;
            margin-bottom: 10px;
        }

        .status-bar {
            min-height: 28px;
            font-weight: 500;
            font-size: 14px;
            text-align: center;
            padding: 6px 16px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .status-bar.error {
            color: var(--error-color);
            background: rgba(248, 81, 73, 0.1);
        }

        .status-bar.success {
            color: var(--success-color);
            background: rgba(63, 185, 80, 0.1);
        }

        .status-bar.info {
            color: var(--info-color);
            background: rgba(88, 166, 255, 0.1);
        }

        .status-bar:empty {
            background: transparent;
        }

        /* ‰∏ªÂÆπÂô®‰ΩàÂ±Ä - ÈüøÊáâÂºè */
        .page-layout {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            flex-wrap: wrap;
            width: 100%;
            max-width: 900px;
        }

        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            width: 100%;
            max-width: 400px;
        }

        /* Âè≥ÂÅ¥ÁçéÂãµË°®ÂçÄÂüü */
        .right-area {
            display: none;
            flex-direction: column;
            width: 200px;
            padding-top: 0;
            gap: 16px;
        }

        @media (min-width: 700px) {
            .right-area {
                display: flex;
            }
        }

        /* ÂàÜÊûêÂçÄÂüü - Êë∫ÁñäÂºè */
        .analysis-section {
            width: 100%;
            max-width: 400px;
            margin-top: 16px;
        }

        .analysis-toggle {
            width: 100%;
            padding: 12px 20px;
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-muted);
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s;
        }

        .analysis-toggle:hover {
            border-color: var(--gold-dim);
            color: var(--text-color);
        }

        .analysis-toggle .toggle-icon {
            transition: transform 0.3s;
        }

        .analysis-toggle.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        .analysis-content {
            display: none;
            flex-direction: column;
            gap: 16px;
            padding-top: 16px;
        }

        .analysis-content.show {
            display: flex;
        }

        /* Èù¢ÊùøÈÄöÁî®Ê®£Âºè */
        .panel {
            background-color: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }

        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            color: var(--gold);
            margin: 0 0 16px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: 1px;
        }

        .panel-title .icon {
            font-size: 16px;
        }

        /* Ë®àÁÆóÂô®Èù¢Êùø */
        .calculator-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 5x5 Á∂≤Ê†º‰ΩàÂ±Ä */
        .grid-wrapper {
            display: grid;
            grid-template-columns: repeat(5, auto);
            grid-template-rows: repeat(5, auto);
            gap: 10px;
            align-items: center;
            justify-items: center;
        }

        /* Ëº∏ÂÖ•Ê°ÜÊ®£Âºè */
        .cell-input {
            width: 64px;
            height: 64px;
            font-size: 28px;
            text-align: center;
            background-color: var(--input-bg);
            border: 2px solid var(--border-color);
            color: var(--gold);
            border-radius: 50%;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .cell-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(240, 180, 41, 0.3);
        }

        .cell-input:hover:not(.disabled-look) {
            border-color: var(--gold-highlight);
            transform: scale(1.05);
        }

        .cell-input.filled {
            background-color: rgba(240, 180, 41, 0.1);
            border-color: var(--gold-dim);
        }

        .cell-input.disabled-look {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .cell-input.recommended {
            border-color: #7fff7f !important;
            box-shadow: 0 0 15px #4a9f4a, inset 0 0 10px rgba(74, 159, 74, 0.3);
            animation: pulse-recommend 1.5s infinite;
            position: relative;
        }

        .cell-input.recommended::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border: 2px solid #7fff7f;
            border-radius: 10px;
            animation: recommendGlow 1.5s infinite;
            pointer-events: none;
        }

        @keyframes pulse-recommend {
            0%, 100% { 
                box-shadow: 0 0 15px #4a9f4a, inset 0 0 10px rgba(74, 159, 74, 0.3);
            }
            50% { 
                box-shadow: 0 0 25px #7fff7f, inset 0 0 15px rgba(74, 159, 74, 0.5);
            }
        }

        @keyframes recommendGlow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .cell-input.error-shake {
            animation: shake 0.3s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* ÁµêÊûúÊ®ôÁ±§ */
        .result-tag {
            font-size: 13px;
            color: var(--text-muted);
            padding: 6px 8px;
            min-width: 55px;
            text-align: center;
            border-radius: 6px;
            background: var(--panel-bg-light);
            transition: all 0.3s ease;
            font-weight: 500;
            font-family: 'Orbitron', monospace;
        }

        .result-tag.highlight {
            background: var(--gradient-gold);
            color: #000;
            font-weight: bold;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(240, 180, 41, 0.5);
        }

        .result-tag.arrow-only {
            background: transparent;
            font-family: sans-serif;
        }

        .arrow { 
            color: var(--gold-dim); 
            font-size: 20px;
        }

        /* ÊåâÈàïÂçÄ */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
            font-family: 'Noto Sans TC', sans-serif;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .btn-reset {
            background-color: var(--panel-bg-light);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .btn-reset:hover { 
            background-color: var(--border-color); 
        }

        .btn-undo {
            background-color: var(--info-color);
            color: #000;
        }

        .btn-undo:hover {
            background-color: #79b8ff;
        }

        .btn-undo:disabled {
            background-color: var(--panel-bg-light);
            color: var(--text-muted);
            cursor: not-allowed;
            transform: none;
        }

        /* Êè≠Ê†ºÂª∫Ë≠∞Èù¢Êùø */
        .suggestion-panel {
            min-width: 280px;
        }

        .suggestion-content {
            font-size: 14px;
            line-height: 1.8;
        }

        .suggestion-highlight {
            color: var(--cyan);
            font-weight: 700;
            font-size: 18px;
        }

        .suggestion-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 12px 0;
        }

        .suggestion-cell {
            background: var(--panel-bg-light);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            font-size: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .suggestion-cell.best {
            border-color: var(--cyan);
            background: rgba(57, 211, 83, 0.1);
        }

        .suggestion-cell .ev-value {
            font-family: 'Orbitron', monospace;
            font-size: 16px;
            font-weight: 700;
            color: var(--gold);
            display: block;
            margin-top: 4px;
        }

        .suggestion-cell.best .ev-value {
            color: var(--cyan);
        }

        .suggestion-cell.disabled {
            opacity: 0.3;
        }

        /* Á∑öË∑ØÂàÜÊûêÈù¢Êùø */
        .line-analysis {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .line-row {
            display: grid;
            grid-template-columns: 70px 80px 1fr 100px;
            gap: 12px;
            align-items: center;
            padding: 10px 12px;
            background: var(--panel-bg-light);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .line-row.best {
            border-color: var(--gold);
            background: rgba(240, 180, 41, 0.05);
        }

        .line-row.safest {
            border-color: var(--cyan);
        }

        .line-name {
            font-weight: 600;
            font-size: 13px;
            color: var(--text-muted);
        }

        .line-ev {
            font-family: 'Orbitron', monospace;
            font-size: 16px;
            font-weight: 700;
            color: var(--gold);
        }

        .line-row.best .line-ev {
            color: var(--gold-highlight);
        }

        .prob-bar-container {
            display: flex;
            gap: 2px;
            height: 20px;
            border-radius: 4px;
            overflow: hidden;
            background: var(--input-bg);
        }

        .prob-segment {
            height: 100%;
            transition: width 0.3s ease;
            position: relative;
        }

        .prob-segment.jackpot { background: var(--gold); }
        .prob-segment.high { background: var(--purple); }
        .prob-segment.medium { background: var(--info-color); }
        .prob-segment.low { background: var(--border-color); }

        .risk-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .risk-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .risk-badge.low-risk {
            background: rgba(57, 211, 83, 0.2);
            color: var(--cyan);
        }

        .risk-badge.medium-risk {
            background: rgba(247, 129, 102, 0.2);
            color: var(--orange);
        }

        .risk-badge.high-risk {
            background: rgba(248, 81, 73, 0.2);
            color: var(--error-color);
        }

        /* Âúñ‰æã */
        .legend {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 8px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-dot.jackpot { background: var(--gold); }
        .legend-dot.high { background: var(--purple); }
        .legend-dot.medium { background: var(--info-color); }
        .legend-dot.low { background: var(--border-color); }

        /* ÁçéÂãµË°® */
        .payout-section {
            display: flex;
            gap: 16px;
        }
        
        .payout-table {
            border-collapse: collapse;
            font-size: 12px;
            flex: 1;
        }
        
        .payout-table th, .payout-table td {
            border: 1px solid var(--border-color);
            padding: 6px 10px;
            text-align: center;
        }
        
        .payout-table th { 
            background-color: var(--panel-bg-light); 
            color: var(--gold);
            font-family: 'Orbitron', sans-serif;
            font-size: 11px;
            letter-spacing: 1px;
        }
        
        .row-jackpot { 
            background-color: rgba(240, 180, 41, 0.15);
            color: var(--gold);
            font-weight: 600;
        }

        .row-high {
            background-color: rgba(163, 113, 247, 0.1);
        }

        /* Ê®°ÂºèÂàáÊèõ */
        .mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .mode-btn {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
            background: var(--panel-bg-light);
            border: 1px solid var(--border-color);
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }

        .mode-btn.active {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
        }

        .mode-btn:hover:not(.active) {
            border-color: var(--gold-dim);
            color: var(--text-color);
        }

        /* Áµ±Ë®àÊëòË¶Å */
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: var(--panel-bg-light);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .stat-value {
            font-family: 'Orbitron', monospace;
            font-size: 18px;
            font-weight: 700;
            color: var(--gold);
        }

        .stat-value.green { color: var(--cyan); }
        .stat-value.purple { color: var(--purple); }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 1100px) {
            .main-container {
                grid-template-columns: 1fr;
            }

            .right-section {
                order: -1;
            }
        }

        @media (max-width: 600px) {
            .cell-input {
                width: 52px;
                height: 52px;
                font-size: 22px;
            }

            .grid-wrapper {
                gap: 6px;
            }

            .result-tag {
                font-size: 11px;
                min-width: 45px;
                padding: 4px 6px;
            }

            .line-row {
                grid-template-columns: 60px 70px 1fr;
            }

            .risk-indicator {
                display: none;
            }

            .stats-summary {
                grid-template-columns: 1fr;
            }

            .payout-section {
                flex-direction: column;
            }
        }

        /* ÊèêÁ§∫ÊñáÂ≠ó */
        .hint-text {
            font-size: 12px;
            color: var(--text-muted);
            text-align: center;
            margin-top: 8px;
        }

        .phase-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            background: var(--panel-bg-light);
            border: 1px solid var(--border-color);
        }

        .phase-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gold);
        }

        .phase-indicator.picking .phase-dot { background: var(--cyan); }
        .phase-indicator.choosing .phase-dot { background: var(--purple); }

        /* Ê≠•È©üÊåáÁ§∫Âô® */
        .step-indicator {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
        }

        .step {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            background: var(--panel-bg-light);
            border: 2px solid var(--border-color);
            color: var(--text-muted);
            transition: all 0.3s;
        }

        .step.active {
            background: var(--gradient-gold);
            color: #000;
            border-color: var(--gold);
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(240, 180, 41, 0.4);
        }

        .step.done {
            background: linear-gradient(135deg, var(--cyan) 0%, #2d7a2d 100%);
            border-color: var(--cyan);
            color: #000;
        }

        /* Êìç‰ΩúÊåáÂºïÈù¢Êùø */
        .instruction-panel {
            width: 100%;
            max-width: 380px;
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            padding: 12px 16px;
            border-radius: 8px;
        }

        .instruction-header {
            color: var(--gold);
            font-weight: bold;
            font-size: 13px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'Orbitron', sans-serif;
        }

        .instruction-content {
            color: var(--text-muted);
            font-size: 13px;
            line-height: 1.5;
        }

        .instruction-content .text-highlight {
            color: var(--cyan);
            font-weight: bold;
        }

        .instruction-content .text-gold {
            color: var(--gold);
            font-weight: bold;
        }

        /* Ê†ºÂ≠êÈ°èËâ≤ÂçÄÂàÜ */
        .cell-input.initial-cell {
            background: linear-gradient(135deg, #8a5a2d 0%, #5a3a1a 100%) !important;
            border-color: #df9f4a !important;
        }

        .cell-input.revealed-cell {
            background: linear-gradient(135deg, #2d5a8a 0%, #1a3a5a 100%) !important;
            border-color: #4a9fdf !important;
        }

        .cell-input.best-line-cell {
            border-color: var(--error-color) !important;
            box-shadow: 0 0 20px var(--error-color), inset 0 0 25px rgba(248, 81, 73, 0.4) !important;
            animation: cellPulse 1s infinite !important;
            position: relative;
        }

        .cell-input.best-line-cell::before {
            content: "";
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 3px solid var(--error-color);
            border-radius: 55%;
            animation: cellPulse 1s infinite;
        }

        @keyframes cellPulse {
            0%, 100% { 
                box-shadow: 0 0 20px var(--error-color), inset 0 0 25px rgba(248, 81, 73, 0.4); 
                border-color: var(--error-color); 
            }
            50% { 
                box-shadow: 0 0 35px #ff6666, inset 0 0 35px rgba(255, 100, 100, 0.5); 
                border-color: #ff6666; 
            }
        }

        @keyframes bestLinePulse {
            0%, 100% { box-shadow: 0 0 20px rgba(248, 81, 73, 0.5), inset 0 0 15px rgba(248, 81, 73, 0.2); }
            50% { box-shadow: 0 0 30px rgba(248, 81, 73, 0.7), inset 0 0 20px rgba(248, 81, 73, 0.3); }
        }

        /* Ê†ºÂ≠êÂúñ‰æã */
        .cell-legend {
            display: flex;
            justify-content: center;
            gap: 14px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            color: var(--text-muted);
        }

        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
        }

        .legend-box.initial {
            border-color: #df9f4a;
            background: rgba(138, 90, 45, 0.4);
        }

        .legend-box.revealed {
            border-color: #4a9fdf;
            background: rgba(45, 90, 138, 0.4);
        }

        .legend-box.recommended {
            border-color: #7fff7f;
            box-shadow: 0 0 6px #4a9f4a;
            background: rgba(74, 159, 74, 0.2);
        }

        /* ÊúÄ‰Ω≥ÈÅ∏Êìá Banner */
        .best-choice-banner {
            padding: 14px;
            background: linear-gradient(135deg, var(--panel-bg) 0%, #1a1a2a 100%);
            border-radius: 10px;
            border: 2px solid var(--error-color);
            box-shadow: 0 4px 15px rgba(248, 81, 73, 0.2);
            width: 100%;
            max-width: 380px;
        }

        .banner-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 10px;
        }

        .banner-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .banner-icon {
            font-size: 24px;
        }

        .banner-title {
            font-size: 10px;
            color: var(--text-muted);
            margin-bottom: 1px;
        }

        .banner-line {
            font-size: 14px;
            font-weight: bold;
            color: var(--text-color);
        }

        .banner-right {
            text-align: right;
        }

        .banner-ev-label {
            font-size: 10px;
            color: var(--text-muted);
            margin-bottom: 1px;
        }

        .banner-ev-value {
            font-size: 22px;
            font-weight: bold;
            color: var(--gold);
            font-family: 'Orbitron', monospace;
        }

        .banner-ev-unit {
            font-size: 12px;
            color: var(--gold);
        }

        .banner-probs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 8px;
        }

        .prob-tag {
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 12px;
            color: var(--text-muted);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .prob-tag .prob-mgp {
            color: var(--gold);
            font-weight: bold;
            display: block;
            font-family: 'Orbitron', monospace;
        }

        .prob-tag .prob-percent {
            color: var(--text-muted);
            font-size: 10px;
        }

        .prob-tag.high-value {
            background: rgba(240, 180, 41, 0.1);
            border-color: var(--gold-dim);
        }

        .prob-tag.jackpot {
            background: rgba(248, 81, 73, 0.15);
            border-color: var(--error-color);
            animation: jackpotGlow 1.5s infinite;
        }

        @keyframes jackpotGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(248, 81, 73, 0.3); }
            50% { box-shadow: 0 0 15px rgba(248, 81, 73, 0.5); }
        }

        /* VS Â∞çÊ±∫Èù¢Êùø */
        .vs-container {
            width: 100%;
            max-width: 380px;
            display: flex;
            gap: 8px;
        }

        .vs-card {
            flex: 1;
            background: var(--panel-bg);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .vs-card.risky {
            background: linear-gradient(180deg, rgba(248, 81, 73, 0.1) 0%, transparent 100%);
            border: 1px solid var(--error-color);
        }

        .vs-card.safe {
            background: linear-gradient(180deg, rgba(88, 166, 255, 0.1) 0%, transparent 100%);
            border: 1px solid var(--info-color);
        }

        .vs-icon { font-size: 20px; margin-bottom: 4px; }
        .vs-title { font-size: 11px; font-weight: bold; margin-bottom: 4px; }
        .vs-card.risky .vs-title { color: var(--error-color); }
        .vs-card.safe .vs-title { color: var(--info-color); }

        .vs-line-name {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 6px;
            min-height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .vs-value-box { margin-bottom: 6px; }
        .vs-label { font-size: 9px; color: var(--text-muted); }
        .vs-value { font-size: 16px; font-weight: bold; font-family: 'Orbitron', monospace; }
        .vs-value.gold { color: var(--gold); }
        .vs-value.blue { color: var(--info-color); }
        .vs-unit { font-size: 10px; color: var(--text-muted); }

        .vs-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 60px;
            padding-top: 10px;
        }

        .vs-badge {
            font-size: 11px;
            font-weight: bold;
            background: var(--text-color);
            color: var(--bg-color);
            padding: 2px 6px;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .win-rate-label { font-size: 8px; color: var(--text-muted); margin-bottom: 2px; text-align: center; }
        .win-rate-val { font-size: 15px; font-weight: bold; color: var(--cyan); font-family: 'Orbitron', monospace; }
        .win-rate-desc { font-size: 9px; color: var(--text-muted); margin-top: 3px; text-align: center; }

        .vs-probs {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-top: auto;
        }

        .vs-prob-row {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            padding: 2px 5px;
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
        }

        .vs-prob-val { color: var(--gold); font-family: 'Orbitron', monospace; }
        .vs-prob-pct { color: var(--text-muted); }

        /* Êï∏Â≠óÈÅ∏Êìá Modal */
        .number-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .number-modal.show {
            display: flex;
        }

        .number-grid {
            background: var(--panel-bg);
            padding: 24px;
            border-radius: 16px;
            border: 2px solid var(--gold);
            box-shadow: 0 0 40px rgba(240, 180, 41, 0.3);
        }

        .number-grid h4 {
            text-align: center;
            margin: 0 0 16px 0;
            color: var(--gold);
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            letter-spacing: 1px;
        }

        .number-options {
            display: grid;
            grid-template-columns: repeat(3, 70px);
            gap: 10px;
        }

        .number-btn {
            width: 70px;
            height: 70px;
            font-size: 28px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            background: var(--panel-bg-light);
            color: var(--text-color);
            border: 2px solid var(--border-color);
            transition: all 0.2s;
            font-family: 'Orbitron', sans-serif;
        }

        .number-btn:hover:not(:disabled) {
            background: var(--gold);
            color: #000;
            transform: scale(1.1);
            border-color: var(--gold);
        }

        .number-btn:disabled {
            background: var(--input-bg);
            color: var(--border-color);
            cursor: not-allowed;
            opacity: 0.4;
        }

        .number-btn.cancel-btn {
            grid-column: span 3;
            width: 100%;
            height: 50px;
            font-size: 16px;
            background: var(--panel-bg-light);
            margin-top: 10px;
            color: var(--text-muted);
            border-radius: 8px;
            font-family: 'Noto Sans TC', sans-serif;
        }

        .number-btn.cancel-btn:hover {
            background: var(--border-color);
            color: var(--text-color);
            transform: none;
        }

        /* Âè≥ÂÅ¥ÁçéÂãµË°®Ê®£Âºè */
        .payout-panel-side {
            background: var(--panel-bg);
            border-radius: 10px;
            padding: 12px;
            border: 1px solid var(--border-color);
        }

        .payout-panel-side h3 {
            color: var(--gold);
            margin: 0 0 10px 0;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
            font-size: 13px;
            font-family: 'Orbitron', sans-serif;
        }

        .payout-section-side {
            display: flex;
            gap: 8px;
        }

        .payout-section-side .payout-table {
            font-size: 11px;
        }

        .payout-section-side .payout-table th,
        .payout-section-side .payout-table td {
            padding: 4px 6px;
        }
    </style>
</head>
<body>

<div id="app">
    <h1>üåµ ‰ªô‰∫∫ÂæÆÂΩ©Ë®àÁÆóÂô®</h1>
    
    <!-- Ê≠•È©üÊåáÁ§∫Âô® -->
    <div class="step-indicator">
        <div class="step" :class="{ active: filledCount === 0, done: filledCount >= 1 }">Âàù</div>
        <div class="step" :class="{ active: filledCount === 1, done: filledCount >= 2 }">1</div>
        <div class="step" :class="{ active: filledCount === 2, done: filledCount >= 3 }">2</div>
        <div class="step" :class="{ active: filledCount === 3, done: filledCount >= 4 }">3</div>
        <div class="step" :class="{ active: filledCount >= 4 }">ÈÅ∏</div>
    </div>

    <!-- Êìç‰ΩúÊåáÂºïÈù¢Êùø -->
    <div class="instruction-panel">
        <div class="instruction-header">üìã Êìç‰ΩúÊåáÂºï</div>
        <div class="instruction-content" v-html="instructionText"></div>
    </div>

    <div class="page-layout">
        <div class="game-area">
            <div class="main-container">
                <!-- Ë®àÁÆóÂô®Èù¢Êùø -->
                <div class="panel calculator-panel">
                    <div class="grid-wrapper">
                        <!-- Á¨¨‰∏ÄË°å -->
                        <div class="result-tag" :class="{ highlight: isBest('diag-1'), 'arrow-only': filledCount === 0 }">{{ displayEV('diag-1') }}</div>
                        <div class="result-tag" :class="{ highlight: isBest('col-0'), 'arrow-only': filledCount === 0 }">{{ displayEV('col-0') }}</div>
                        <div class="result-tag" :class="{ highlight: isBest('col-1'), 'arrow-only': filledCount === 0 }">{{ displayEV('col-1') }}</div>
                        <div class="result-tag" :class="{ highlight: isBest('col-2'), 'arrow-only': filledCount === 0 }">{{ displayEV('col-2') }}</div>
                        <div class="result-tag" :class="{ highlight: isBest('diag-2'), 'arrow-only': filledCount === 0 }">{{ displayEV('diag-2') }}</div>

                        <!-- Á¨¨‰∫åË°å -->
                        <div class="result-tag" :class="{ highlight: isBest('row-0'), 'arrow-only': filledCount === 0 }">{{ displayEV('row-0') }}</div>
                        <template v-for="i in [0, 1, 2]">
                            <div 
                                class="cell-input" 
                                :class="getCellClass(i)"
                                :id="'cell-' + i"
                                :aria-label="'Ê†ºÂ≠ê ' + (i + 1)"
                                @click="handleCellClick(i)"
                                tabindex="0"
                                @keydown="handleKeyDown(i, $event)">
                                {{ cells[i] }}
                            </div>
                        </template>
                        <div class="arrow"></div>

                        <!-- Á¨¨‰∏âË°å -->
                        <div class="result-tag" :class="{ highlight: isBest('row-1'), 'arrow-only': filledCount === 0 }">{{ displayEV('row-1') }}</div>
                        <template v-for="i in [3, 4, 5]">
                            <div 
                                class="cell-input" 
                                :class="getCellClass(i)"
                        :id="'cell-' + i"
                        :aria-label="'Ê†ºÂ≠ê ' + (i + 1)"
                        @click="handleCellClick(i)"
                        tabindex="0"
                        @keydown="handleKeyDown(i, $event)">
                        {{ cells[i] }}
                    </div>
                </template>
                <div class="arrow"></div>

                <!-- Á¨¨ÂõõË°å -->
                <div class="result-tag" :class="{ highlight: isBest('row-2'), 'arrow-only': filledCount === 0 }">{{ displayEV('row-2') }}</div>
                <template v-for="i in [6, 7, 8]">
                    <div 
                        class="cell-input" 
                        :class="getCellClass(i)"
                        :id="'cell-' + i"
                        :aria-label="'Ê†ºÂ≠ê ' + (i + 1)"
                        @click="handleCellClick(i)"
                        tabindex="0"
                        @keydown="handleKeyDown(i, $event)">
                        {{ cells[i] }}
                    </div>
                </template>
                <div class="arrow"></div>

                <!-- Á¨¨‰∫îË°å -->
                <div></div>
                <div class="arrow"></div>
                <div class="arrow"></div>
                <div class="arrow"></div>
                <div></div>
            </div>

            <div class="button-group">
                <button class="btn btn-undo" @click="undo" :disabled="history.length === 0">
                    ‚Ü∂ Êí§Èä∑
                </button>
                <button class="btn btn-reset" @click="resetGrid">
                    ÈáçÁΩÆÁõ§Èù¢
                </button>
            </div>

            <!-- Ê†ºÂ≠êÂúñ‰æã -->
            <div class="cell-legend">
                <div class="legend-item"><div class="legend-box initial"></div> ÂàùÂßã</div>
                <div class="legend-item"><div class="legend-box revealed"></div> Â∑≤Êè≠</div>
                <div class="legend-item"><div class="legend-box recommended"></div> Êé®Ëñ¶</div>
            </div>
        </div>

        <!-- ÊúÄ‰Ω≥ÈÅ∏Êìá Banner (ÂñÆ‰∏ÄÊúÄ‰Ω≥ÊôÇÈ°ØÁ§∫) -->
        <div class="best-choice-banner" v-if="filledCount >= 4 && !showVSMode">
            <div class="banner-header">
                <div class="banner-left">
                    <div class="banner-icon">üéØ</div>
                    <div>
                        <div class="banner-title">ÊúÄ‰Ω≥ÈÅ∏Êìá</div>
                        <div class="banner-line">{{ bestLineDisplay.name }}</div>
                    </div>
                </div>
                <div class="banner-right">
                    <div class="banner-ev-label">Âπ≥ÂùáÊúüÊúõÂÄº</div>
                    <div class="banner-ev-value">{{ bestLineDisplay.ev.toLocaleString() }} <span class="banner-ev-unit">MGP</span></div>
                </div>
            </div>
            <div class="banner-probs">
                <div v-for="prob in bestLineDisplay.probs" 
                     :key="prob.mgp"
                     class="prob-tag"
                     :class="{ jackpot: prob.mgp >= 10000, 'high-value': prob.mgp >= 1000 && prob.mgp < 10000 }">
                    <span class="prob-mgp">{{ prob.mgp.toLocaleString() }}</span>
                    <span class="prob-percent">({{ prob.percent }}%)</span>
                </div>
            </div>
        </div>

        <!-- VS Â∞çÊ±∫Èù¢Êùø (È¢®Èö™ vs ‰øùÂ∫ï Ë°ùÁ™ÅÊôÇÈ°ØÁ§∫) -->
        <div class="vs-container" v-if="filledCount >= 4 && showVSMode">
            <div class="vs-card risky">
                <div class="vs-icon">üéØ</div>
                <div class="vs-title">ÊúÄ‰Ω≥ÊúüÊúõÂÄº</div>
                <div class="vs-line-name">{{ vsData.risky.name }}</div>
                <div class="vs-value-box">
                    <div class="vs-label">Âπ≥ÂùáÊúüÊúõÂÄº</div>
                    <div class="vs-value gold">{{ vsData.risky.ev.toLocaleString() }}</div>
                    <div class="vs-unit">MGP</div>
                </div>
                <div class="vs-probs">
                    <div v-for="prob in vsData.risky.topProbs" :key="prob.mgp" class="vs-prob-row">
                        <span class="vs-prob-val">{{ prob.mgp.toLocaleString() }}</span>
                        <span class="vs-prob-pct">{{ prob.percent }}%</span>
                    </div>
                </div>
            </div>

            <div class="vs-center">
                <div class="vs-badge">VS</div>
                <div class="win-rate-label">ÊìäÊïó‰øùÂ∫ïÊ©üÁéá</div>
                <div class="win-rate-val">{{ vsData.winRate }}%</div>
                <div class="win-rate-desc" :style="{ color: vsData.riskColor }">{{ vsData.riskLabel }}</div>
            </div>

            <div class="vs-card safe">
                <div class="vs-icon">üõ°Ô∏è</div>
                <div class="vs-title">ÊúÄÈ´ò‰øùÂ∫ï</div>
                <div class="vs-line-name">{{ vsData.safe.name }}</div>
                <div class="vs-value-box">
                    <div class="vs-label">‰øùË≠âÁç≤Âæó</div>
                    <div class="vs-value blue">{{ vsData.safe.minMGP.toLocaleString() }}</div>
                    <div class="vs-unit">MGP</div>
                </div>
                <div class="vs-probs" style="justify-content: center; color: var(--text-muted); font-size: 11px; padding: 10px;">
                    ÊîæÊ£ÑÂ§ßÁçé<br>Á©©ÊãøÁçéÂãµ
                </div>
            </div>
        </div>
        </div>
        </div>

        <!-- Âè≥ÂÅ¥ÁçéÂãµË°® (Â§ßËû¢ÂπïÈ°ØÁ§∫) -->
        <div class="right-area">
            <div class="payout-panel-side">
                <h3>üí∞ ÁçéÂãµË°®</h3>
                <div class="payout-section-side">
                    <table class="payout-table">
                        <tr><th>Á∏ΩÂíå</th><th>MGP</th></tr>
                        <tr class="row-jackpot"><td>6</td><td>10,000</td></tr>
                        <tr><td>7</td><td>36</td></tr>
                        <tr class="row-high"><td>8</td><td>720</td></tr>
                        <tr><td>9</td><td>360</td></tr>
                        <tr><td>10</td><td>80</td></tr>
                        <tr><td>11</td><td>252</td></tr>
                        <tr><td>12</td><td>108</td></tr>
                        <tr><td>13</td><td>72</td></tr>
                        <tr><td>14</td><td>54</td></tr>
                    </table>
                    <table class="payout-table">
                        <tr><th>Á∏ΩÂíå</th><th>MGP</th></tr>
                        <tr><td>15</td><td>180</td></tr>
                        <tr><td>16</td><td>72</td></tr>
                        <tr><td>17</td><td>180</td></tr>
                        <tr><td>18</td><td>119</td></tr>
                        <tr><td>19</td><td>36</td></tr>
                        <tr><td>20</td><td>306</td></tr>
                        <tr class="row-high"><td>21</td><td>1,080</td></tr>
                        <tr><td>22</td><td>144</td></tr>
                        <tr class="row-high"><td>23</td><td>1,800</td></tr>
                        <tr class="row-jackpot"><td>24</td><td>3,600</td></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂàÜÊûêÂçÄÂüüÔºàÂèØÊë∫ÁñäÔºâ -->
    <div class="analysis-section">
        <button class="analysis-toggle" :class="{ expanded: showAnalysis }" @click="showAnalysis = !showAnalysis">
            <span>üìä Ë©≥Á¥∞ÂàÜÊûê</span>
            <span class="toggle-icon">‚ñº</span>
        </button>
        
        <div class="analysis-content" :class="{ show: showAnalysis }">
            <!-- Êè≠Ê†ºÂª∫Ë≠∞ -->
            <div class="panel suggestion-panel" v-if="filledCount > 0 && filledCount < 4">
                <h3 class="panel-title"><span class="icon">üéØ</span> Êè≠Ê†ºÂª∫Ë≠∞</h3>
                <div class="suggestion-content">
                    <p>
                        <template v-if="bestRevealCells.length === 1">
                            Âª∫Ë≠∞Êè≠Èñã‰ΩçÁΩÆ <span class="suggestion-highlight">{{ bestRevealCell + 1 }}</span> ËôüÊ†º
                        </template>
                        <template v-else>
                            Âª∫Ë≠∞Êè≠Èñã‰ΩçÁΩÆ 
                            <span v-for="(cellIdx, i) in bestRevealCells" :key="cellIdx">
                                <span class="suggestion-highlight">{{ cellIdx + 1 }}</span><span v-if="i < bestRevealCells.length - 1">„ÄÅ</span>
                            </span>
                            ËôüÊ†º (Á≠âÂÉπ)
                        </template>
                        <br>
                        <small style="color: var(--text-muted)">È†êÊúüÂæåÁ∫åÊúÄ‰Ω≥ EV: {{ bestRevealEV.toLocaleString() }} MGP</small>
                    </p>
                    <div class="suggestion-grid">
                        <div v-for="i in 9" 
                             :key="i"
                             class="suggestion-cell"
                             :class="{ 
                                 best: bestRevealCells.includes(i-1) && cells[i-1] === '',
                                 disabled: cells[i-1] !== ''
                             }">
                            <template v-if="cells[i-1] !== ''">
                                <span style="color: var(--gold)">{{ cells[i-1] }}</span>
                            </template>
                            <template v-else>
                                <span>{{ i }}</span>
                                <span class="ev-value">{{ revealAnalysis[i-1] ? revealAnalysis[i-1].toLocaleString() : '-' }}</span>
                            </template>
                        </div>
                    </div>
                    <p style="font-size: 12px; color: var(--text-muted);">
                        Êï∏ÂÄºË°®Á§∫Êè≠ÈñãË©≤Ê†ºÂæåÁöÑÈ†êÊúüÊúÄ‰Ω≥Á∑ö EV
                    </p>
                </div>
            </div>

            <!-- Áµ±Ë®àÊëòË¶Å -->
            <div class="panel" v-if="filledCount >= 1">
                <h3 class="panel-title"><span class="icon">üìä</span> Áµ±Ë®àÊëòË¶Å</h3>
                <div class="stats-summary">
                    <div class="stat-card">
                        <div class="stat-label">ÊúÄ‰Ω≥ÊúüÊúõÂÄº</div>
                        <div class="stat-value">{{ evResults.max.toLocaleString() }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ÊúÄ‰ΩéÈ¢®Èö™Á∑ö</div>
                        <div class="stat-value green">{{ safestLine }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Â§ßÁçéÊ©üÁéá</div>
                        <div class="stat-value purple">{{ (bestJackpotProb * 100).toFixed(1) }}%</div>
                    </div>
                </div>
            </div>

            <!-- Á∑öË∑ØÂàÜÊûê -->
            <div class="panel" v-if="filledCount >= 1">
                <h3 class="panel-title"><span class="icon">üìà</span> Á∑öË∑ØÂàÜÊûê</h3>
                
                <div class="mode-toggle">
                    <button class="mode-btn" :class="{ active: sortMode === 'ev' }" @click="sortMode = 'ev'">‰æùÊúüÊúõÂÄº</button>
                    <button class="mode-btn" :class="{ active: sortMode === 'risk' }" @click="sortMode = 'risk'">‰æùÈ¢®Èö™</button>
                    <button class="mode-btn" :class="{ active: sortMode === 'jackpot' }" @click="sortMode = 'jackpot'">‰æùÂ§ßÁçéÁéá</button>
                </div>

                <div class="line-analysis">
                    <div v-for="line in sortedLineAnalysis" 
                         :key="line.key"
                         class="line-row"
                         :class="{ best: line.isBest, safest: line.isSafest }">
                        <div class="line-name">{{ line.displayName }}</div>
                        <div class="line-ev">{{ line.ev.toLocaleString() }}</div>
                        <div class="prob-bar-container" :title="getProbTooltip(line)">
                            <div class="prob-segment jackpot" :style="{ width: (line.jackpotProb * 100) + '%' }"></div>
                            <div class="prob-segment high" :style="{ width: (line.highProb * 100) + '%' }"></div>
                            <div class="prob-segment medium" :style="{ width: (line.mediumProb * 100) + '%' }"></div>
                            <div class="prob-segment low" :style="{ width: (line.lowProb * 100) + '%' }"></div>
                        </div>
                        <div class="risk-indicator">
                            <span class="risk-badge" :class="line.riskClass">{{ line.riskLabel }}</span>
                        </div>
                    </div>
                </div>

                <div class="legend">
                    <div class="legend-item"><span class="legend-dot jackpot"></span> Â§ßÁçé (6,24)</div>
                    <div class="legend-item"><span class="legend-dot high"></span> È´òÈ°ç (21,23)</div>
                    <div class="legend-item"><span class="legend-dot medium"></span> ‰∏≠Á≠â (8,20)</div>
                    <div class="legend-item"><span class="legend-dot low"></span> ÂÖ∂‰ªñ</div>
                </div>
            </div>

            <!-- ÁçéÂãµË°® -->
            <div class="panel">
                <h3 class="panel-title"><span class="icon">üí∞</span> ÁçéÂãµË°®</h3>
                <div class="payout-section">
                    <table class="payout-table">
                        <tr><th>Á∏ΩÂíå</th><th>MGP</th></tr>
                        <tr class="row-jackpot"><td>6</td><td>10,000</td></tr>
                        <tr><td>7</td><td>36</td></tr>
                        <tr class="row-high"><td>8</td><td>720</td></tr>
                        <tr><td>9</td><td>360</td></tr>
                        <tr><td>10</td><td>80</td></tr>
                        <tr><td>11</td><td>252</td></tr>
                        <tr><td>12</td><td>108</td></tr>
                        <tr><td>13</td><td>72</td></tr>
                        <tr><td>14</td><td>54</td></tr>
                    </table>
                    <table class="payout-table">
                        <tr><th>Á∏ΩÂíå</th><th>MGP</th></tr>
                        <tr><td>15</td><td>180</td></tr>
                        <tr><td>16</td><td>72</td></tr>
                        <tr><td>17</td><td>180</td></tr>
                        <tr><td>18</td><td>119</td></tr>
                        <tr><td>19</td><td>36</td></tr>
                        <tr><td>20</td><td>306</td></tr>
                        <tr class="row-high"><td>21</td><td>1,080</td></tr>
                        <tr><td>22</td><td>144</td></tr>
                        <tr class="row-high"><td>23</td><td>1,800</td></tr>
                        <tr class="row-jackpot"><td>24</td><td>3,600</td></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Êï∏Â≠óÈÅ∏Êìá Modal -->
    <div class="number-modal" id="number-modal" @click.self="hideNumberModal">
        <div class="number-grid">
            <h4>ÈÅ∏ÊìáÊï∏Â≠ó</h4>
            <div class="number-options">
                <button 
                    v-for="n in 9" 
                    :key="n"
                    class="number-btn"
                    :disabled="usedNums.includes(n)"
                    @click="selectNumber(n)">
                    {{ n }}
                </button>
                <button class="number-btn cancel-btn" @click="hideNumberModal">ÂèñÊ∂à</button>
            </div>
        </div>
    </div>
</div>

<script>
    new Vue({
        el: '#app',
        data: {
            cells: Array(9).fill(''),
            cellOrder: [],           // Ë®òÈåÑÂ°´ÂÖ•È†ÜÂ∫èÔºåÂçÄÂàÜÂàùÂßã/Êè≠Èú≤
            message: '',
            messageType: '',
            errorCell: null,
            history: [],
            sortMode: 'ev',
            selectedCell: null,
            showModal: false,
            showAnalysis: false,     // ÂàÜÊûêÈù¢ÊùøÊë∫ÁñäÁãÄÊÖã
            payouts: {
                6: 10000, 7: 36, 8: 720, 9: 360, 10: 80,
                11: 252, 12: 108, 13: 72, 14: 54, 15: 180,
                16: 72, 17: 180, 18: 119, 19: 36, 20: 306,
                21: 1080, 22: 144, 23: 1800, 24: 3600
            },
            lines: {
                "row-0": [0, 1, 2], "row-1": [3, 4, 5], "row-2": [6, 7, 8],
                "col-0": [0, 3, 6], "col-1": [1, 4, 7], "col-2": [2, 5, 8],
                "diag-1": [0, 4, 8], "diag-2": [2, 4, 6]
            },
            lineNames: {
                "row-0": "Ê©´Âàó 1", "row-1": "Ê©´Âàó 2", "row-2": "Ê©´Âàó 3",
                "col-0": "Áõ¥Ë°å 1", "col-1": "Áõ¥Ë°å 2", "col-2": "Áõ¥Ë°å 3",
                "diag-1": "Â∞çËßí ‚Üò", "diag-2": "Â∞çËßí ‚Üô"
            },
            // ÁçéÂãµÂàÜÈ°û
            jackpotSums: [6, 24],      // Â§ßÁçé
            highSums: [21, 23],        // È´òÈ°ç
            mediumSums: [8, 20],       // ‰∏≠Á≠â
        },
        computed: {
            filledCount() {
                return this.cells.filter(c => c !== '').length;
            },

            currentPhase() {
                if (this.filledCount < 4) return 'picking';
                return 'choosing';
            },

            // Êìç‰ΩúÊåáÂºïÊñáÂ≠ó
            instructionText() {
                switch(this.filledCount) {
                    case 0:
                        return 'Ê≠•È©ü 0ÔºöËº∏ÂÖ•ÂàùÂßãÊï∏Â≠ó<br>Ë´ã‰æùÁÖßÈÅäÊà≤Áï´Èù¢ÔºåÈªûÊìäËº∏ÂÖ•<span class="text-gold">ÂàùÂßãÂ∑≤Êè≠Èú≤</span>ÁöÑÊï∏Â≠ó„ÄÇ';
                    case 1:
                        return 'Ê≠•È©ü 1ÔºöÈÅ∏ÊìáÊè≠Èú≤‰ΩçÁΩÆ (Ââ©È§ò 3 Ê¨°)<br>Êé®Ëñ¶Êè≠Èú≤ <span class="text-highlight">Á∂†Ê°ÜÊ†ºÂ≠ê</span>ÔºåÊúâ‰∏≠ÈñìÂÖàÈÅ∏‰∏≠Èñì„ÄÇ';
                    case 2:
                        return 'Ê≠•È©ü 2ÔºöÈÅ∏ÊìáÊè≠Èú≤‰ΩçÁΩÆ (Ââ©È§ò 2 Ê¨°)<br>Êé®Ëñ¶Êè≠Èú≤ <span class="text-highlight">Á∂†Ê°ÜÊ†ºÂ≠ê</span>ÔºåÂèØÁç≤ÂæóÊúÄÈ´òÊúüÊúõÂÄº„ÄÇ';
                    case 3:
                        return 'Ê≠•È©ü 3ÔºöÈÅ∏ÊìáÊè≠Èú≤‰ΩçÁΩÆ (Ââ©È§ò 1 Ê¨°)<br>Êé®Ëñ¶Êè≠Èú≤ <span class="text-highlight">Á∂†Ê°ÜÊ†ºÂ≠ê</span>ÔºåÂÅöÊúÄÂæåÁ¢∫Ë™ç„ÄÇ';
                    default:
                        return 'ÊúÄÁµÇÈÅ∏ÊìáÔºöÊ±∫ÂÆöÈÄ£Á∑ö<br>Êü•Áúã‰∏ãÊñπÂàÜÊûêÔºåÈÅ∏Êìá <span class="text-gold">ÈáëËâ≤È´ò‰∫Æ</span> ÁöÑÊúÄ‰Ω≥Ë∑ØÁ∑öÔºÅ';
                }
            },

            phaseText() {
                if (this.filledCount === 0) return 'Á≠âÂæÖËº∏ÂÖ•...';
                if (this.filledCount < 4) return `Êè≠Ê†ºÈöéÊÆµ (${this.filledCount}/4)`;
                return 'ÈÅ∏Á∑öÈöéÊÆµ - Êü•ÁúãÈáëËâ≤È´ò‰∫Æ';
            },

            usedNums() {
                return this.cells.filter(c => c !== '').map(Number);
            },

            availableNums() {
                return [1,2,3,4,5,6,7,8,9].filter(n => !this.usedNums.includes(n));
            },

            // Ë®àÁÆóÊâÄÊúâÁ∑öÁöÑÊúüÊúõÂÄºÂíåË©≥Á¥∞ÂàÜÊûêÔºàÂê´ payout ÂàÜÂ∏ÉÔºâ
            lineStatsWithDist() {
                const stats = [];
                for (let [key, indices] of Object.entries(this.lines)) {
                    const analysis = this.analyzeLineWithDist(indices);
                    stats.push({
                        key: key,
                        name: this.lineNames[key],
                        indices: indices,
                        ...analysis
                    });
                }
                return stats;
            },

            // ÊúÄ‰Ω≥Á∑öÔºàÊúÄÈ´ò EVÔºâ
            bestLine() {
                if (this.lineStatsWithDist.length === 0) return null;
                return this.lineStatsWithDist.reduce((best, line) => 
                    line.ev > best.ev ? line : best
                );
            },

            // ÊúÄÈ´ò‰øùÂ∫ïÁ∑ö
            safestMinLine() {
                if (this.lineStatsWithDist.length === 0) return null;
                return this.lineStatsWithDist.reduce((best, line) => 
                    line.minMGP > best.minMGP ? line : best
                );
            },

            // ÊòØÂê¶È°ØÁ§∫ VS Ê®°Âºè
            showVSMode() {
                if (this.filledCount < 4) return false;
                if (!this.bestLine || !this.safestMinLine) return false;
                return this.bestLine.minMGP < this.safestMinLine.minMGP;
            },

            // ÊúÄ‰Ω≥ÈÅ∏Êìá Banner Ë≥áÊñô
            bestLineDisplay() {
                if (!this.bestLine) return { name: '-', ev: 0, probs: [] };
                
                // ÊâæÂá∫ÊâÄÊúâÂêåÂàÜÊúÄ‰Ω≥Á∑ö
                const maxEV = this.bestLine.ev;
                const bestLines = this.lineStatsWithDist.filter(l => l.ev === maxEV);
                const names = bestLines.map(l => l.name).join(' Êàñ ');
                
                const probs = Object.entries(this.bestLine.payoutDist || {})
                    .map(([mgp, count]) => ({
                        mgp: parseInt(mgp),
                        percent: ((count / this.bestLine.count) * 100).toFixed(1)
                    }))
                    .sort((a, b) => b.mgp - a.mgp);
                
                return { name: names, ev: this.bestLine.ev, probs: probs };
            },

            // VS Â∞çÊ±∫Ë≥áÊñô
            vsData() {
                if (!this.bestLine || !this.safestMinLine) {
                    return { risky: {}, safe: {}, winRate: 0, riskLabel: '', riskColor: '' };
                }
                
                const threshold = this.safestMinLine.minMGP;
                let winCount = 0;
                const probs = [];
                
                Object.entries(this.bestLine.payoutDist || {}).forEach(([mgp, count]) => {
                    if (parseInt(mgp) > threshold) winCount += count;
                    probs.push({ mgp: parseInt(mgp), count: count, percent: ((count / this.bestLine.count) * 100).toFixed(0) });
                });
                
                const winRate = ((winCount / this.bestLine.count) * 100).toFixed(0);
                
                let riskLabel, riskColor;
                if (winRate >= 60) {
                    riskLabel = 'ÂÄºÂæó‰∏ÄË©¶';
                    riskColor = 'var(--cyan)';
                } else if (winRate >= 40) {
                    riskLabel = 'È¢®Èö™ÈÅ©‰∏≠';
                    riskColor = 'var(--gold)';
                } else {
                    riskLabel = 'È´òÈ¢®Èö™';
                    riskColor = 'var(--error-color)';
                }
                
                probs.sort((a, b) => b.mgp - a.mgp);
                
                return {
                    risky: {
                        name: this.bestLine.name,
                        ev: this.bestLine.ev,
                        topProbs: probs.slice(0, 3)
                    },
                    safe: {
                        name: this.safestMinLine.name,
                        minMGP: this.safestMinLine.minMGP
                    },
                    winRate: winRate,
                    riskLabel: riskLabel,
                    riskColor: riskColor
                };
            },

            // ÊúÄ‰Ω≥Á∑öÊ†ºÂ≠êÔºàÁî®ÊñºÈ´ò‰∫ÆÔºâ
            bestLineCells() {
                if (this.filledCount < 4 || !this.bestLine) return [];
                return this.bestLine.indices;
            },

            // Ë®àÁÆóÊâÄÊúâÁ∑öÁöÑÊúüÊúõÂÄºÂíåË©≥Á¥∞ÂàÜÊûê
            evResults() {
                let results = {};
                let max = -1;

                for (let [key, indices] of Object.entries(this.lines)) {
                    const analysis = this.analyzeLineDetailed(indices);
                    results[key] = analysis;
                    if (analysis.ev > max) max = analysis.ev;
                }
                
                return { values: results, max: max };
            },

            // Á∑öË∑ØÂàÜÊûêÈô£Âàó
            lineAnalysis() {
                const analysis = [];
                const minStdDev = Math.min(...Object.values(this.evResults.values).map(v => v.stdDev));
                
                for (let [key, data] of Object.entries(this.evResults.values)) {
                    analysis.push({
                        key: key,
                        displayName: this.lineNames[key],
                        ev: data.ev,
                        stdDev: data.stdDev,
                        jackpotProb: data.jackpotProb,
                        highProb: data.highProb,
                        mediumProb: data.mediumProb,
                        lowProb: data.lowProb,
                        isBest: data.ev === this.evResults.max,
                        isSafest: data.stdDev === minStdDev,
                        riskClass: this.getRiskClass(data.stdDev),
                        riskLabel: this.getRiskLabel(data.stdDev)
                    });
                }
                return analysis;
            },

            sortedLineAnalysis() {
                const arr = [...this.lineAnalysis];
                switch (this.sortMode) {
                    case 'ev':
                        return arr.sort((a, b) => b.ev - a.ev);
                    case 'risk':
                        return arr.sort((a, b) => a.stdDev - b.stdDev);
                    case 'jackpot':
                        return arr.sort((a, b) => (b.jackpotProb + b.highProb) - (a.jackpotProb + a.highProb));
                    default:
                        return arr;
                }
            },

            safestLine() {
                const safest = this.lineAnalysis.find(l => l.isSafest);
                return safest ? safest.displayName : '-';
            },

            bestJackpotProb() {
                return Math.max(...this.lineAnalysis.map(l => l.jackpotProb + l.highProb));
            },

            // Êè≠Ê†ºÂàÜÊûê
            revealAnalysis() {
                if (this.filledCount === 0 || this.filledCount >= 4) {
                    return Array(9).fill(null);
                }

                const results = [];
                for (let cellIdx = 0; cellIdx < 9; cellIdx++) {
                    if (this.cells[cellIdx] !== '') {
                        results.push(null);
                        continue;
                    }
                    results.push(this.calculateRevealEV(cellIdx));
                }
                return results;
            },

            bestRevealCell() {
                let bestIdx = -1;
                let bestEV = -1;
                this.revealAnalysis.forEach((ev, idx) => {
                    if (ev !== null && ev > bestEV) {
                        bestEV = ev;
                        bestIdx = idx;
                    }
                });
                return bestIdx;
            },

            // ÊâÄÊúâÂÖ∑ÊúâÁõ∏ÂêåÊúÄ‰Ω≥ EV ÁöÑÊé®Ëñ¶Ê†ºÂ≠êÔºàË§áÊï∏Ôºâ
            bestRevealCells() {
                let bestEV = -1;
                // ÂÖàÊâæÂá∫ÊúÄÈ´ò EV
                this.revealAnalysis.forEach((ev, idx) => {
                    if (ev !== null && ev > bestEV) {
                        bestEV = ev;
                    }
                });
                // Êî∂ÈõÜÊâÄÊúâÂÖ∑ÊúâÁõ∏ÂêåÊúÄÈ´ò EV ÁöÑÊ†ºÂ≠ê
                const result = [];
                if (bestEV >= 0) {
                    this.revealAnalysis.forEach((ev, idx) => {
                        // ‰ΩøÁî®Â∞èÊï∏ÈªûÂÆπÂ∑ÆÊØîËºÉÔºåÈÅøÂÖçÊµÆÈªûÊï∏Ë™§Â∑Æ
                        if (ev !== null && Math.abs(ev - bestEV) < 0.0001) {
                            result.push(idx);
                        }
                    });
                }
                return result;
            },

            bestRevealEV() {
                const best = this.revealAnalysis[this.bestRevealCell];
                return best || 0;
            }
        },
        mounted() {
            document.addEventListener('keydown', this.handleGlobalKeyDown);
        },
        beforeDestroy() {
            document.removeEventListener('keydown', this.handleGlobalKeyDown);
        },
        methods: {
            // ÂàÜÊûê‰∏ÄÊ¢ùÁ∑öÔºåÂê´ payout ÂàÜÂ∏É
            analyzeLineWithDist(indices) {
                let currentSum = 0;
                let missingIndices = [];

                indices.forEach(idx => {
                    if (this.cells[idx] !== '') {
                        currentSum += parseInt(this.cells[idx]);
                    } else {
                        missingIndices.push(idx);
                    }
                });

                if (missingIndices.length === 0) {
                    const payout = this.payouts[currentSum] || 0;
                    return {
                        ev: payout,
                        minMGP: payout,
                        count: 1,
                        payoutDist: { [payout]: 1 }
                    };
                }

                const perms = this.getPermutations(this.availableNums, missingIndices.length);
                let totalPayout = 0;
                let minPayout = Infinity;
                let payoutDist = {};

                perms.forEach(perm => {
                    const sum = currentSum + perm.reduce((a,b) => a+b, 0);
                    const payout = this.payouts[sum] || 0;
                    totalPayout += payout;
                    if (payout < minPayout) minPayout = payout;
                    payoutDist[payout] = (payoutDist[payout] || 0) + 1;
                });

                return {
                    ev: perms.length === 0 ? 0 : Math.round(totalPayout / perms.length),
                    minMGP: minPayout === Infinity ? 0 : minPayout,
                    count: perms.length,
                    payoutDist: payoutDist
                };
            },

            // ÂèñÂæóÊ†ºÂ≠êÁöÑ CSS È°ûÂà•
            getCellClass(index) {
                const cell = this.cells[index];
                const isEmpty = cell === '';
                
                // Â∑≤Â°´ÂÖ•Êï∏Â≠óÁöÑÊ†ºÂ≠ê
                if (!isEmpty) {
                    // Âà§Êñ∑ÊòØÂàùÂßãÊ†ºÈÇÑÊòØÊè≠Èú≤Ê†º
                    const orderIdx = this.cellOrder.indexOf(index);
                    if (orderIdx === 0) {
                        return { 'initial-cell': true };
                    } else {
                        return { 'revealed-cell': true };
                    }
                }
                
                // ÈÅ∏Á∑öÈöéÊÆµÔºöÈ°ØÁ§∫ÊúÄ‰Ω≥Á∑öÊ†ºÂ≠ê
                if (this.filledCount >= 4) {
                    if (this.bestLineCells.includes(index)) {
                        return { 'best-line-cell': true };
                    }
                    return { 'disabled-look': true };
                }
                
                // Êè≠Ê†ºÈöéÊÆµÔºöÈ°ØÁ§∫Êé®Ëñ¶Êè≠Èú≤Ê†ºÔºàÊâÄÊúâÁõ∏Âêå EV ÁöÑÊ†ºÂ≠êÈÉΩÈ´ò‰∫ÆÔºâ
                const analysis = this.revealAnalysis[index];
                if (analysis !== null && this.bestRevealCells.includes(index)) {
                    return { 'recommended': true };
                }
                
                return {};
            },

            // Ë©≥Á¥∞ÂàÜÊûê‰∏ÄÊ¢ùÁ∑ö
            analyzeLineDetailed(indices) {
                let currentSum = 0;
                let missingIndices = [];

                indices.forEach(idx => {
                    if (this.cells[idx] !== '') {
                        currentSum += parseInt(this.cells[idx]);
                    } else {
                        missingIndices.push(idx);
                    }
                });

                let totalPayout = 0;
                let permutationCount = 0;
                let payoutSquaredSum = 0;
                let jackpotCount = 0;
                let highCount = 0;
                let mediumCount = 0;

                if (missingIndices.length === 0) {
                    const payout = this.payouts[currentSum] || 0;
                    return {
                        ev: payout,
                        stdDev: 0,
                        jackpotProb: this.jackpotSums.includes(currentSum) ? 1 : 0,
                        highProb: this.highSums.includes(currentSum) ? 1 : 0,
                        mediumProb: this.mediumSums.includes(currentSum) ? 1 : 0,
                        lowProb: (!this.jackpotSums.includes(currentSum) && 
                                  !this.highSums.includes(currentSum) && 
                                  !this.mediumSums.includes(currentSum)) ? 1 : 0
                    };
                }

                const perms = this.getPermutations(this.availableNums, missingIndices.length);
                perms.forEach(perm => {
                    const sum = currentSum + perm.reduce((a,b) => a+b, 0);
                    const payout = this.payouts[sum] || 0;
                    totalPayout += payout;
                    payoutSquaredSum += payout * payout;
                    permutationCount++;

                    if (this.jackpotSums.includes(sum)) jackpotCount++;
                    else if (this.highSums.includes(sum)) highCount++;
                    else if (this.mediumSums.includes(sum)) mediumCount++;
                });

                const ev = permutationCount === 0 ? 0 : Math.round(totalPayout / permutationCount);
                const meanSquared = (totalPayout / permutationCount) ** 2;
                const variance = (payoutSquaredSum / permutationCount) - meanSquared;
                const stdDev = Math.sqrt(Math.max(0, variance));

                return {
                    ev: ev,
                    stdDev: Math.round(stdDev),
                    jackpotProb: jackpotCount / permutationCount,
                    highProb: highCount / permutationCount,
                    mediumProb: mediumCount / permutationCount,
                    lowProb: (permutationCount - jackpotCount - highCount - mediumCount) / permutationCount
                };
            },

            // Ë®àÁÆóÊè≠ÈñãÊüêÊ†ºÂæåÁöÑÈ†êÊúüÊúÄ‰Ω≥ EV
            calculateRevealEV(cellIdx) {
                let totalBestEV = 0;
                let count = 0;

                // Â∞çÊØèÂÄãÂèØËÉΩÂá∫ÁèæÁöÑÊï∏Â≠ó
                this.availableNums.forEach(num => {
                    // Êö´ÊôÇË®≠ÁΩÆÈÄôÂÄãÊ†ºÂ≠êÁöÑÂÄº
                    const tempCells = [...this.cells];
                    tempCells[cellIdx] = num.toString();
                    
                    // Ë®àÁÆóÈÄôÁ®ÆÊÉÖÊ≥Å‰∏ãÊâÄÊúâÁ∑öÁöÑ EV
                    const tempUsed = tempCells.filter(c => c !== '').map(Number);
                    const tempAvailable = [1,2,3,4,5,6,7,8,9].filter(n => !tempUsed.includes(n));
                    
                    let maxEV = 0;
                    for (let [key, indices] of Object.entries(this.lines)) {
                        const ev = this.calculateLineEV(tempCells, indices, tempAvailable);
                        if (ev > maxEV) maxEV = ev;
                    }
                    
                    totalBestEV += maxEV;
                    count++;
                });

                return count === 0 ? 0 : Math.round(totalBestEV / count);
            },

            // Ë®àÁÆóÁâπÂÆöÁõ§Èù¢‰∏ã‰∏ÄÊ¢ùÁ∑öÁöÑ EV
            calculateLineEV(cells, indices, available) {
                let currentSum = 0;
                let missingCount = 0;

                indices.forEach(idx => {
                    if (cells[idx] !== '') {
                        currentSum += parseInt(cells[idx]);
                    } else {
                        missingCount++;
                    }
                });

                if (missingCount === 0) {
                    return this.payouts[currentSum] || 0;
                }

                const perms = this.getPermutations(available, missingCount);
                let totalPayout = 0;
                perms.forEach(perm => {
                    const sum = currentSum + perm.reduce((a,b) => a+b, 0);
                    totalPayout += this.payouts[sum] || 0;
                });

                return perms.length === 0 ? 0 : Math.round(totalPayout / perms.length);
            },

            getPermutations(arr, k) {
                if (k === 0) return [[]];
                if (arr.length === 0) return [];
                
                let result = [];
                for (let i = 0; i < arr.length; i++) {
                    const current = arr[i];
                    const remaining = arr.slice(0, i).concat(arr.slice(i + 1));
                    const perms = this.getPermutations(remaining, k - 1);
                    perms.forEach(perm => {
                        result.push([current, ...perm]);
                    });
                }
                return result;
            },

            getRiskClass(stdDev) {
                if (stdDev < 500) return 'low-risk';
                if (stdDev < 1500) return 'medium-risk';
                return 'high-risk';
            },

            getRiskLabel(stdDev) {
                if (stdDev < 500) return 'Á©©ÂÆö';
                if (stdDev < 1500) return '‰∏≠Á≠â';
                return 'È´òÈ¢®Èö™';
            },

            getProbTooltip(line) {
                return `Â§ßÁçé: ${(line.jackpotProb * 100).toFixed(1)}% | ` +
                       `È´òÈ°ç: ${(line.highProb * 100).toFixed(1)}% | ` +
                       `‰∏≠Á≠â: ${(line.mediumProb * 100).toFixed(1)}%`;
            },

            handleCellClick(index) {
                if (this.cells[index] !== '') {
                    // Â∑≤Â°´ÂÖ•ÁöÑÊ†ºÂ≠êÔºöÊ∏ÖÈô§Êï∏Â≠ó
                    this.saveHistory();
                    this.$set(this.cells, index, '');
                    // ÂæûÂ°´ÂÖ•È†ÜÂ∫è‰∏≠ÁßªÈô§
                    const orderIdx = this.cellOrder.indexOf(index);
                    if (orderIdx > -1) {
                        this.cellOrder.splice(orderIdx, 1);
                    }
                    this.clearMessage();
                } else if (this.filledCount < 4) {
                    // Á©∫Ê†ºÂ≠ê‰∏îÊú™Êªø4ÂÄãÔºöÈ°ØÁ§∫Êï∏Â≠óÈÅ∏Êìá Modal
                    this.selectedCell = index;
                    this.showModal = true;
                    document.getElementById('number-modal').classList.add('show');
                }
            },

            hideNumberModal() {
                this.showModal = false;
                this.selectedCell = null;
                document.getElementById('number-modal').classList.remove('show');
            },

            selectNumber(num) {
                if (this.selectedCell === null) return;
                if (this.usedNums.includes(num)) return;
                
                this.saveHistory();
                this.$set(this.cells, this.selectedCell, num.toString());
                // ËøΩËπ§Â°´ÂÖ•È†ÜÂ∫è
                if (!this.cellOrder.includes(this.selectedCell)) {
                    this.cellOrder.push(this.selectedCell);
                }
                this.hideNumberModal();
                
                if (this.filledCount >= 4) {
                    this.showSuccess('Â∑≤Ëº∏ÂÖ• 4 ÂÄãÊï∏Â≠óÔºåÊü•ÁúãÈáëËâ≤È´ò‰∫ÆÁöÑÊúÄ‰Ω≥ÈÅ∏ÊìáÔºÅ');
                }
            },

            handleKeyDown(index, event) {
                // Êï∏Â≠óÈçµ 1-9 Áõ¥Êé•Ëº∏ÂÖ•
                const num = parseInt(event.key);
                if (num >= 1 && num <= 9) {
                    event.preventDefault();
                    if (this.cells[index] !== '' || this.filledCount >= 4) return;
                    if (this.usedNums.includes(num)) {
                        this.showError(`Êï∏Â≠ó ${num} Â∑≤Á∂ìÂ≠òÂú®ÔºÅ`, index);
                        return;
                    }
                    this.saveHistory();
                    this.$set(this.cells, index, num.toString());
                    // ËøΩËπ§Â°´ÂÖ•È†ÜÂ∫è
                    if (!this.cellOrder.includes(index)) {
                        this.cellOrder.push(index);
                    }
                    if (this.filledCount >= 4) {
                        this.showSuccess('Â∑≤Ëº∏ÂÖ• 4 ÂÄãÊï∏Â≠óÔºåÊü•ÁúãÈáëËâ≤È´ò‰∫ÆÁöÑÊúÄ‰Ω≥ÈÅ∏ÊìáÔºÅ');
                    }
                    return;
                }

                // Backspace/Delete Ê∏ÖÈô§
                if (event.key === 'Backspace' || event.key === 'Delete') {
                    event.preventDefault();
                    if (this.cells[index] !== '') {
                        this.saveHistory();
                        this.$set(this.cells, index, '');
                        // ÂæûÂ°´ÂÖ•È†ÜÂ∫è‰∏≠ÁßªÈô§
                        const orderIdx = this.cellOrder.indexOf(index);
                        if (orderIdx > -1) {
                            this.cellOrder.splice(orderIdx, 1);
                        }
                        this.clearMessage();
                    }
                    return;
                }

                // Enter/Space ÈñãÂïü Modal
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    this.handleCellClick(index);
                    return;
                }

                // ÊñπÂêëÈçµÂ∞éËà™
                if (event.key === 'ArrowRight') {
                    event.preventDefault();
                    this.focusNext(index);
                }
                else if (event.key === 'ArrowLeft') {
                    event.preventDefault();
                    this.focusPrevious(index);
                }
                else if (event.key === 'ArrowDown') {
                    event.preventDefault();
                    const nextIndex = index + 3;
                    if (nextIndex < 9) {
                        document.getElementById('cell-' + nextIndex).focus();
                    }
                }
                else if (event.key === 'ArrowUp') {
                    event.preventDefault();
                    const prevIndex = index - 3;
                    if (prevIndex >= 0) {
                        document.getElementById('cell-' + prevIndex).focus();
                    }
                }
            },

            handleGlobalKeyDown(event) {
                if ((event.ctrlKey || event.metaKey) && event.key === 'z') {
                    event.preventDefault();
                    this.undo();
                }
                // Escape ÈóúÈñâ Modal
                if (event.key === 'Escape' && this.showModal) {
                    this.hideNumberModal();
                }
            },

            focusNext(currentIndex) {
                for (let i = 1; i < 9; i++) {
                    let nextIndex = (currentIndex + i) % 9;
                    const el = document.getElementById('cell-' + nextIndex);
                    if (el && !el.classList.contains('disabled-look')) {
                        el.focus();
                        break;
                    }
                }
            },

            focusPrevious(currentIndex) {
                for (let i = 1; i < 9; i++) {
                    let prevIndex = (currentIndex - i + 9) % 9;
                    const el = document.getElementById('cell-' + prevIndex);
                    if (el && !el.classList.contains('disabled-look')) {
                        el.focus();
                        break;
                    }
                }
            },

            resetGrid() {
                this.cells = Array(9).fill('');
                this.cellOrder = [];
                this.history = [];
                this.clearMessage();
            },

            saveHistory() {
                this.history.push({
                    cells: [...this.cells],
                    cellOrder: [...this.cellOrder]
                });
                if (this.history.length > 20) {
                    this.history.shift();
                }
            },

            undo() {
                if (this.history.length > 0) {
                    const state = this.history.pop();
                    this.cells = state.cells;
                    this.cellOrder = state.cellOrder || [];
                    this.showSuccess('Â∑≤Êí§Èä∑');
                }
            },

            showError(msg, cellIndex = null) {
                this.message = msg;
                this.messageType = 'error';
                if (cellIndex !== null) {
                    this.errorCell = cellIndex;
                    setTimeout(() => { this.errorCell = null; }, 300);
                }
            },

            showSuccess(msg) {
                this.message = msg;
                this.messageType = 'success';
            },

            showInfo(msg) {
                this.message = msg;
                this.messageType = 'info';
            },

            clearMessage() {
                this.message = '';
                this.messageType = '';
            },

            displayEV(key) {
                const data = this.evResults.values[key];
                const arrows = {
                    'diag-1': '‚Üò', 'diag-2': '‚Üô',
                    'col-0': '‚Üì', 'col-1': '‚Üì', 'col-2': '‚Üì',
                    'row-0': '‚Üí', 'row-1': '‚Üí', 'row-2': '‚Üí'
                };
                if (this.filledCount === 0) return arrows[key];
                return data.ev.toLocaleString();
            },

            isBest(key) {
                if (this.filledCount === 0) return false;
                return this.evResults.values[key].ev === this.evResults.max;
            },

            isInputDisabled(index) {
                return this.cells[index] === '' && this.filledCount >= 4;
            },

            isRecommendedCell(index) {
                if (this.filledCount === 0 || this.filledCount >= 4) return false;
                return index === this.bestRevealCell && this.cells[index] === '';
            }
        }
    });
</script>

</body>
</html>